@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime

<div class="card card-side bg-base-100 shadow-xl @CardClass"
     data-aos="fade-right" data-aos-offset="100"
     @ref="CardRef">

    <figure class="pl-4">
        <img class="@ImageClass" src="@Image" alt="@ImageAlt" />
    </figure>

    <div class="card-body">
        <h2 class="card-title">@Title</h2>
        <p>@Body</p>

        <div class="card-actions justify-start flex-wrap gap-1">
            @foreach (var tag in Tags.Split(','))
            {
                <span class="badge badge-outline">@tag</span>
            }
        </div>

        @if (ShowDuration && !string.IsNullOrEmpty(StartDate))
        {
            <div class="text-sm opacity-70 mt-2">
                @StartDate - @(string.IsNullOrEmpty(EndDate) ? "Present" : EndDate)
                (@CalculateDuration())
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public string Title { get; set; } = default!;
    [Parameter] public string Image { get; set; } = default!;
    [Parameter] public string ImageAlt { get; set; } = default!;
    [Parameter] public string ImageClass { get; set; } = default!;
    [Parameter] public string? CardClass { get; set; }
    [Parameter] public string Body { get; set; } = default!;
    [Parameter] public string Tags { get; set; } = default!;
    [Parameter] public string? StartDate { get; set; }
    [Parameter] public string? EndDate { get; set; }
    [Parameter] public bool ShowDuration { get; set; } = false;

    private ElementReference CardRef;

    private string CalculateDuration()
    {
        if (string.IsNullOrEmpty(StartDate)) return string.Empty;

        DateTime start = DateTime.Parse(StartDate);
        DateTime end = string.IsNullOrEmpty(EndDate) ? DateTime.Now : DateTime.Parse(EndDate);

        int years = end.Year - start.Year;
        int months = end.Month - start.Month;
        if (end.Day < start.Day) months--;

        if (months < 0)
        {
            years--;
            months += 12;
        }

        if (years > 0)
        {
            return years == 1
                ? $"{years} yr {months} mos"
                : $"{years} yrs {months} mos";
        }
        return $"{months} mos";
    }
}